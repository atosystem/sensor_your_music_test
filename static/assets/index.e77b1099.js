import{f as e}from"./vendor.519c7c38.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,c)=>{const i=new URL(e,o);if(self[t].moduleMap[i])return n(self[t].moduleMap[i]);const s=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),d=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){c(new Error(`Failed to import: ${e}`)),a(d)},onload(){n(self[t].moduleMap[i]),a(d)}});document.head.appendChild(d)})),self[t].moduleMap={}}}("/assets/");const t={apiKey:"AIzaSyChwv4ULSZFHYI3dS1xs_by7eFDfb8I2HE",authDomain:"test-4e071.firebaseapp.com",projectId:"test-4e071",storageBucket:"test-4e071.appspot.com",messagingSenderId:"251598311975",appId:"1:251598311975:web:0216503ce4960f768d3402"};e.apps.length||e.initializeApp(t);const n=e.firestore(),o=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10}),a=document.getElementById("callButton"),c=document.getElementById("callInput"),i=document.getElementById("answerButton"),s=document.getElementById("hangupButton"),d=document.getElementById("txt_send"),l=document.getElementById("btn_send"),r=document.getElementById("div_connect_status"),m=document.getElementById("sensors_ui"),u=document.getElementById("start_demo"),p=document.getElementById("txt_udp_port");var g,v,y,f;(g=o.createDataChannel("sendDataChannel",null)).onopen=b,g.onclose=b,o.ondatachannel=function(e){console.log("Receive Channel Callback"),(v=e.channel).onmessage=I,v.onopen=L,v.onclose=L};const w=new URLSearchParams(window.location.search),h=Object.fromEntries(w.entries());function I(e){y.send(`${f}:${e.data}`)}function b(){let e=g.readyState;console.log("Send channel state is: "+e),r.innerHTML="open"===e?"connected to server":"disconnected to server"}function L(){let e=v.readyState;console.log("Receive channel state is: "+e)}console.log(h),l.onclick=function(e){let t=d.value;g.send(t),console.log("Sent Data: "+t)},a.onclick=async()=>{if(""===p.value)return void alert("Please assign udp port to pd");f=parseInt(p.value),p.disabled=!0,console.log(`Using udp port=${f}`);const e=n.collection("calls").doc(),t=e.collection("offerCandidates"),a=e.collection("answerCandidates");c.value=e.id;let i=document.createElement("img");i.src=`https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=https://atosystem.github.io/testcontrol/?connect_code=${e.id}`,m.appendChild(i),document.title=`Listen to ${f}`,o.onicecandidate=e=>{e.candidate&&t.add(e.candidate.toJSON())};const d=await o.createOffer();await o.setLocalDescription(d);const l={sdp:d.sdp,type:d.type};await e.set({offer:l}),e.onSnapshot((e=>{const t=e.data();if(!o.currentRemoteDescription&&(null==t?void 0:t.answer)){const e=new RTCSessionDescription(t.answer);o.setRemoteDescription(e)}})),a.onSnapshot((e=>{console.log("Candidate answered"),e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());o.addIceCandidate(t)}}))})),s.disabled=!1};const _=async()=>{const e=c.value,t=n.collection("calls").doc(e),a=t.collection("answerCandidates"),i=t.collection("offerCandidates");o.onicecandidate=e=>{e.candidate&&a.add(e.candidate.toJSON())};const s=(await t.get()).data().offer;await o.setRemoteDescription(new RTCSessionDescription(s));const d=await o.createAnswer();await o.setLocalDescription(d);const l={type:d.type,sdp:d.sdp};await t.update({answer:l}),i.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){let t=e.doc.data();o.addIceCandidate(new RTCIceCandidate(t))}}))}))};i.onclick=_,"connect_code"in h?(c.value=h.connect_code,c.disabled=!0,a.disabled=!0,i.disabled=!0,r.innerHTML="connecting to server",_()):"localhost"===location.hostname||"127.0.0.1"===location.hostname?(console.log("Using localhost"),r.innerHTML="Please Start the server",u.classList.add("disabled"),m.innerHTML="",i.disabled=!0,c.disabled=!1,(y=new WebSocket("ws://localhost:3005")).onopen=()=>{console.log("[ws]open connection")},y.onclose=()=>{console.log("[ws]close connection")}):r.innerHTML="Free mode";var E=[0,0,0];function C(e){S("Orientation_a",e.alpha),S("Orientation_b",e.beta),S("Orientation_g",e.gamma),E=[e.alpha,e.beta,e.gamma],R()}function R(){let e=document.getElementById("num-observed-events"),t=parseInt(e.innerHTML);e.innerHTML=t+1}function S(e,t,n=10){null!=t&&(document.getElementById(e).innerHTML=t.toFixed(n))}function $(e){let t="";t+=`${e.accelerationIncludingGravity.x} ${e.accelerationIncludingGravity.y} ${e.accelerationIncludingGravity.z} `,t+=`${e.acceleration.x} ${e.acceleration.y} ${e.acceleration.z} `,t+=`${e.rotationRate.alpha} ${e.rotationRate.beta} ${e.rotationRate.gamma} `,t+=`${E[0]} ${E[1]} ${E[2]}`,g.send(`${t}`),S("Accelerometer_gx",e.accelerationIncludingGravity.x),S("Accelerometer_gy",e.accelerationIncludingGravity.y),S("Accelerometer_gz",e.accelerationIncludingGravity.z),S("Accelerometer_x",e.acceleration.x),S("Accelerometer_y",e.acceleration.y),S("Accelerometer_z",e.acceleration.z),S("Accelerometer_i",e.interval,2),S("Gyroscope_z",e.rotationRate.alpha),S("Gyroscope_x",e.rotationRate.beta),S("Gyroscope_y",e.rotationRate.gamma),R()}let B=!1;u.onclick=function(e){e.preventDefault(),DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission&&DeviceMotionEvent.requestPermission(),B?(window.removeEventListener("devicemotion",$),window.removeEventListener("deviceorientation",C),u.innerHTML="Start demo",u.classList.add("btn-success"),u.classList.remove("btn-danger"),B=!1):(window.addEventListener("devicemotion",$),window.addEventListener("deviceorientation",C),document.getElementById("start_demo").innerHTML="Stop demo",u.classList.remove("btn-success"),u.classList.add("btn-danger"),B=!0)};
